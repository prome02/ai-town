# 離散位置系統測試指南

## 🧪 自動化測試

### 運行單元測試

```bash
# 運行所有測試
npm test

# 運行位置系統測試
npm test -- location.test.ts
```

### 測試覆蓋範圍

- ✅ 位置數據驗證
- ✅ 位置 ID 唯一性
- ✅ 地圖邊界檢查
- ✅ 位置類型驗證
- ✅ 必填字段檢查

---

## 🖱️ 手動測試計劃

### 前置條件

1. 啟動開發服務器：
```bash
npm run dev
```

2. 等待 Convex 同步完成
3. 打開瀏覽器訪問 `http://localhost:5173`

---

### 測試案例 1：查看位置列表

**步驟**：
1. 打開應用
2. 查看右側欄頂部的「📍 可用位置」區域

**預期結果**：
- ✅ 顯示 8 個位置
- ✅ 每個位置顯示圖標、名稱、描述
- ✅ 顯示位置類型標籤（顏色區分）
- ✅ 顯示玩家數量（初始為 0）

**驗證點**：
- 城鎮廣場 🏛️ (public - 紫色)
- 咖啡廳 ☕ (social - 藍色)
- 圖書館 📚 (leisure - 綠色)
- 公園 🌳 (leisure - 綠色)
- 辦公室 💼 (work - 琥珀色)
- 市場 🛒 (public - 紫色)
- 花園 🌺 (leisure - 綠色)
- 社區中心 🏘️ (social - 藍色)

---

### 測試案例 2：加入遊戲

**步驟**：
1. 點擊頁面底部的「Interact」按鈕
2. 等待加入完成

**預期結果**：
- ✅ 玩家成功加入遊戲
- ✅ 「城鎮廣場」位置顯示「當前」徽章
- ✅ 「城鎮廣場」玩家數量增加到 1
- ✅ 位置按鈕變為可點擊狀態

**驗證點**：
- 當前位置高亮顯示（較深的背景色）
- 當前位置有橙色「當前」徽章
- 其他位置按鈕可懸停變色

---

### 測試案例 3：移動到新位置

**步驟**：
1. 確保已加入遊戲
2. 點擊「咖啡廳」位置按鈕
3. 等待 1-2 秒

**預期結果**：
- ✅ 「咖啡廳」變為當前位置（顯示徽章）
- ✅ 「城鎮廣場」不再高亮
- ✅ 「城鎮廣場」玩家數量減少到 0
- ✅ 「咖啡廳」玩家數量增加到 1

**驗證點**：
- 移動是即時的（無延遲）
- 玩家數量實時更新
- 只有一個位置顯示「當前」徽章

---

### 測試案例 4：在不同位置類型間移動

**步驟**：
1. 依次點擊不同類型的位置：
   - 公園 (leisure)
   - 辦公室 (work)
   - 市場 (public)
   - 社區中心 (social)

**預期結果**：
- ✅ 每次點擊都成功移動
- ✅ 當前位置徽章正確跟隨
- ✅ 玩家數量正確更新

**驗證點**：
- 不同類型位置都可正常訪問
- 無錯誤信息
- UI 狀態同步正確

---

### 測試案例 5：多玩家場景（需要多個瀏覽器標籤）

**步驟**：
1. 打開第二個瀏覽器標籤
2. 在第二個標籤中點擊「Interact」加入遊戲
3. 觀察兩個標籤的位置列表

**預期結果**：
- ✅ 「城鎮廣場」顯示 2 個玩家
- ✅ 兩個標籤都實時更新玩家數量

**步驟（續）**：
4. 在第一個標籤移動到「咖啡廳」
5. 在第二個標籤移動到「圖書館」

**預期結果**：
- ✅ 標籤 1：咖啡廳顯示當前，玩家數 1
- ✅ 標籤 2：圖書館顯示當前，玩家數 1
- ✅ 城鎮廣場玩家數 0
- ✅ 兩個標籤數據同步

---

### 測試案例 6：UI 響應式設計

**步驟**：
1. 調整瀏覽器窗口大小
2. 測試不同屏幕尺寸：
   - 桌面 (1400px+)
   - 平板 (768px - 1024px)
   - 手機 (< 768px)

**預期結果**：
- ✅ 位置列表在所有尺寸下可讀
- ✅ 按鈕保持可點擊
- ✅ 滾動正常工作
- ✅ 文字不溢出

---

### 測試案例 7：未加入遊戲狀態

**步驟**：
1. 刷新頁面（未點擊 Interact）
2. 查看位置列表

**預期結果**：
- ✅ 位置列表正常顯示
- ✅ 所有位置按鈕禁用（灰色）
- ✅ 底部顯示提示：「💡 點擊 Interact 加入遊戲以使用位置系統」

**驗證點**：
- 無法點擊任何位置
- 視覺上清楚表明禁用狀態

---

### 測試案例 8：當前位置重複點擊

**步驟**：
1. 確保已加入遊戲且在「城鎮廣場」
2. 再次點擊「城鎮廣場」按鈕

**預期結果**：
- ✅ 按鈕無反應（cursor: default）
- ✅ 無錯誤發生
- ✅ 狀態保持不變

---

### 測試案例 9：快速連續點擊

**步驟**：
1. 快速連續點擊多個位置（咖啡廳 → 圖書館 → 公園）

**預期結果**：
- ✅ 每次點擊都被處理
- ✅ 最終位置正確
- ✅ 無錯誤或崩潰

---

## 🐛 已知限制和注意事項

### 當前版本限制

1. **Agent AI 尚未適配**
   - AI 角色仍使用舊的連續移動系統
   - 可能會看到警告信息（不影響功能）

2. **地圖可視化**
   - 玩家頭像仍在地圖中央顯示
   - 尚未根據位置坐標調整顯示

3. **移動動畫**
   - 位置切換是即時的
   - 無過渡動畫

### 預期警告信息

在控制台可能看到：
```
movePlayer() is deprecated in discrete location system. Use moveToLocation instead.
```

這是正常的，是舊系統兼容性警告。

---

## ✅ 測試檢查清單

### 功能測試
- [ ] 位置列表正確顯示所有 8 個位置
- [ ] 加入遊戲功能正常
- [ ] 默認位置設為城鎮廣場
- [ ] 點擊位置可成功移動
- [ ] 當前位置正確高亮
- [ ] 玩家數量實時更新
- [ ] 多玩家數據同步
- [ ] 未加入時按鈕禁用

### UI/UX 測試
- [ ] 圖標正確顯示
- [ ] 類型顏色正確
- [ ] 響應式布局正常
- [ ] 懸停效果工作
- [ ] 滾動流暢
- [ ] 提示信息清晰

### 性能測試
- [ ] 位置列表加載快速 (< 1s)
- [ ] 移動響應即時 (< 500ms)
- [ ] 無明顯延遲或卡頓
- [ ] 多玩家場景下性能穩定

### 錯誤處理
- [ ] 無 JavaScript 錯誤
- [ ] 無控制台紅色錯誤
- [ ] 網絡失敗時優雅降級

---

## 📊 測試報告模板

### 測試環境
- 日期：_______
- 瀏覽器：_______
- 屏幕尺寸：_______
- 測試人員：_______

### 測試結果

| 測試案例 | 通過 | 失敗 | 備註 |
|---------|------|------|------|
| 1. 查看位置列表 | ☐ | ☐ | |
| 2. 加入遊戲 | ☐ | ☐ | |
| 3. 移動到新位置 | ☐ | ☐ | |
| 4. 不同類型位置 | ☐ | ☐ | |
| 5. 多玩家場景 | ☐ | ☐ | |
| 6. 響應式設計 | ☐ | ☐ | |
| 7. 未加入狀態 | ☐ | ☐ | |
| 8. 重複點擊 | ☐ | ☐ | |
| 9. 快速連續點擊 | ☐ | ☐ | |

### 發現的問題

1. _______
2. _______
3. _______

### 總體評估

- 整體穩定性：⭐⭐⭐⭐⭐
- 用戶體驗：⭐⭐⭐⭐⭐
- 性能表現：⭐⭐⭐⭐⭐

---

## 🔍 調試技巧

### 查看位置數據

在瀏覽器控制台：
```javascript
// 查看所有位置
await convex.query(api.world.worldLocations, { worldId: "..." })

// 查看當前玩家
await convex.query(api.world.worldState, { worldId: "..." })
```

### 查看數據庫

使用 Convex Dashboard：
1. 運行 `npx convex dashboard`
2. 查看 `locations` 表
3. 查看 `worlds` 表中的 players 數組

### 常見問題排查

**Q: 位置列表不顯示？**
A: 檢查 Convex 是否正常連接，確認 locations 表有數據

**Q: 點擊位置無反應？**
A: 確認已點擊 Interact 加入遊戲，檢查控制台錯誤

**Q: 玩家數量不更新？**
A: 刷新頁面，檢查網絡連接，確認 Convex 實時同步正常

---

## 🚀 下一步測試

完成基礎測試後，可以進行：

1. **壓力測試**：10+ 玩家同時移動
2. **長時間穩定性**：運行 1 小時+
3. **邊緣情況**：網絡中斷、快速切換等

---

## 📝 反饋

測試中發現任何問題，請記錄：
- 重現步驟
- 預期行為
- 實際行為
- 截圖/錯誤信息

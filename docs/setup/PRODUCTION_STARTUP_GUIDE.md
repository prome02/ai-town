# AI Town æ­£å¼ç’°å¢ƒå•Ÿå‹•æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•ä½¿ç”¨ `start-ai-town-production.bat` å•Ÿå‹• AI Town çš„æ­£å¼/ç”Ÿç”¢ç’°å¢ƒã€‚

## æœ¬åœ°æ¸¬è©¦ vs æ­£å¼ç’°å¢ƒ

### æœ¬åœ°æ¸¬è©¦ç’°å¢ƒ (`start-ai-town-local.bat`)
- ä½¿ç”¨æœ¬åœ° Convex å¾Œç«¯ (port 3210)
- é€£æ¥æœ¬åœ° Ollama LLM æœå‹™
- å®Œæ•´é›¢ç·šé–‹ç™¼èƒ½åŠ›
- é©åˆåŠŸèƒ½é–‹ç™¼èˆ‡æ¸¬è©¦

### æ­£å¼ç’°å¢ƒ (`start-ai-town-production.bat`)
- ä½¿ç”¨ Convex é›²ç«¯éƒ¨ç½²
- éœ€è¦ç¶²è·¯é€£ç·š
- é©åˆæ­£å¼éƒ¨ç½²èˆ‡å±•ç¤º
- LLM åŠŸèƒ½éœ€é›²ç«¯ API

## ç’°å¢ƒéœ€æ±‚

### å¿…å‚™æ¢ä»¶
- Node.js å·²å®‰è£
- å·²è¨­å®š `.env.local` æª”æ¡ˆ
- Convex å¸³è™Ÿå·²ç™»å…¥

### å¯é¸æ¢ä»¶
- é›²ç«¯ LLM API (OpenAI, Anthropic ç­‰)

## ä½¿ç”¨æ–¹å¼

### 1. åŸºæœ¬å•Ÿå‹•

```bash
# ç›´æ¥åŸ·è¡Œå•Ÿå‹•è…³æœ¬
.\start-ai-town-production.bat
```

è…³æœ¬æœƒè‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿ:
1. æª¢æŸ¥ `.env.local` æª”æ¡ˆ
2. ç¢ºä¿ Convex URL è¨­å®šç‚ºé›²ç«¯æ¨¡å¼
3. æª¢æŸ¥ä¸¦å®‰è£å°ˆæ¡ˆä¾è³´
4. åŒæ­¥ Convex å‡½æ•¸è‡³é›²ç«¯
5. å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨

### 2. è¨ªå•æ‡‰ç”¨

å•Ÿå‹•æˆåŠŸå¾Œ,åœ¨ç€è¦½å™¨è¨ªå•:
- ä¸»æ‡‰ç”¨: http://localhost:5173/ai-town/

### 3. åœæ­¢æœå‹™

å¯ä»¥ä½¿ç”¨çµ±ä¸€çš„åœæ­¢è…³æœ¬:
```bash
.\stop-ai-town.bat
```

æˆ–æ‰‹å‹•é—œé–‰é–‹å•Ÿçš„è¦–çª—:
- Convex Dev è¦–çª—
- AI Town Frontend è¦–çª—

## å•Ÿå‹•æµç¨‹è©³è§£

### [1/5] æª¢æŸ¥ç”Ÿç”¢ç’°å¢ƒè¨­å®š

é©—è­‰ `.env.local` æª”æ¡ˆæ˜¯å¦å­˜åœ¨:
```
âœ… .env.local æª”æ¡ˆå­˜åœ¨
```

### [2/5] æª¢æŸ¥ Convex é›²ç«¯é€£ç·šè¨­å®š

è‡ªå‹•æª¢æŸ¥ä¸¦ä¿®æ­£ `.env.local` ä¸­çš„ `VITE_CONVEX_URL`:
- é æœŸå€¼: `https://elegant-lobster-3.convex.cloud`
- å¦‚åµæ¸¬åˆ°æœ¬åœ° URL,æœƒè‡ªå‹•åˆ‡æ›ç‚ºé›²ç«¯æ¨¡å¼
- æœƒè‡ªå‹•å‚™ä»½åŸè¨­å®šç‚º `.env.local.backup`

```
âœ… Convex URL å·²æ­£ç¢ºè¨­å®šç‚ºé›²ç«¯æ¨¡å¼
```

### [3/5] æª¢æŸ¥å°ˆæ¡ˆä¾è³´

æª¢æŸ¥ `node_modules/` æ˜¯å¦å­˜åœ¨:
- å¦‚ä¸å­˜åœ¨,è‡ªå‹•åŸ·è¡Œ `npm install`
- å¦‚å·²å­˜åœ¨,è·³éå®‰è£æ­¥é©Ÿ

```
âœ… ä¾è³´å·²å°±ç·’
```

### [4/5] åŒæ­¥ Convex å‡½æ•¸è‡³é›²ç«¯

å•Ÿå‹• Convex Dev è¦–çª—,å°‡æœ¬åœ°å‡½æ•¸åŒæ­¥è‡³é›²ç«¯:
```bash
npx convex dev
```

ç‰¹æ€§:
- Convex CLI æœƒè‡ªå‹•ç®¡ç† `.env.local`
- æœƒå°‡é›²ç«¯éƒ¨ç½² URL å¯«å…¥ `.env.local`
- ç­‰å¾… 15 ç§’ç¢ºä¿åŒæ­¥å®Œæˆ

```
âœ… Convex å‡½æ•¸åŒæ­¥ä¸­ (è«‹æª¢æŸ¥æ–°é–‹å•Ÿçš„è¦–çª—)
```

### [5/5] å•Ÿå‹•å‰ç«¯æ‡‰ç”¨

å•Ÿå‹• Vite é–‹ç™¼ä¼ºæœå™¨:
```bash
npm run dev:frontend
```

```
âœ… å‰ç«¯æ‡‰ç”¨å·²å•Ÿå‹•
```

## æˆåŠŸå•Ÿå‹•å¾Œçš„æœå‹™ç‹€æ…‹

```
ğŸ“ æœå‹™ç‹€æ…‹:
   â€¢ Convex é›²ç«¯:       https://elegant-lobster-3.convex.cloud
   â€¢ Convex Dev:        æ­£åœ¨åŒæ­¥è‡³é›²ç«¯ (æª¢æŸ¥æ–°è¦–çª—)
   â€¢ å‰ç«¯æ‡‰ç”¨:          http://localhost:5173 (æˆ– Vite åˆ†é…çš„ç«¯å£)
```

## ç’°å¢ƒè®Šæ•¸è¨­å®š

### `.env.local` æ­£å¼ç’°å¢ƒé…ç½®

```env
VITE_CONVEX_URL=https://elegant-lobster-3.convex.cloud
```

### LLM API é…ç½®

ç”±æ–¼æ­£å¼ç’°å¢ƒä½¿ç”¨é›²ç«¯ Convex,æœ¬åœ° Ollama ç„¡æ³•è¨ªå•ã€‚éœ€è¦é…ç½®é›²ç«¯å¯è¨ªå•çš„ LLM APIã€‚

åœ¨ [convex/util/llm.ts](../../convex/util/llm.ts) ä¸­ä¿®æ”¹:

```typescript
export const LLM_CONFIG = {
  ollama: false,  // æ”¹ç‚º false
  url: 'https://api.openai.com/v1',  // æ”¹ç‚ºé›²ç«¯ API
  chatModel: 'gpt-4',  // ä½¿ç”¨é›²ç«¯æ¨¡å‹
  embeddingModel: 'text-embedding-ada-002',
  embeddingDimension: 1536,
  apiKey: () => process.env.OPENAI_API_KEY,  // è¨­å®š API Key
};
```

ä¸¦åœ¨ `.env.local` æ·»åŠ :
```env
OPENAI_API_KEY=sk-your-api-key-here
```

## å¸¸è¦‹å•é¡Œæ’é™¤

### 1. Convex ç™»å…¥å•é¡Œ

**éŒ¯èª¤**: ç„¡æ³•åŒæ­¥å‡½æ•¸è‡³é›²ç«¯

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç™»å…¥ Convex å¸³è™Ÿ
npx convex login

# é©—è­‰ç™»å…¥ç‹€æ…‹
npx convex whoami
```

### 2. ç«¯å£è¡çª

**éŒ¯èª¤**: ç«¯å£ 5173 å·²è¢«ä½”ç”¨

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹ä½”ç”¨é€²ç¨‹
netstat -ano | findstr ":5173"

# æˆ–ä½¿ç”¨åœæ­¢è…³æœ¬æ¸…ç†
.\stop-ai-town.bat
```

### 3. ä¾è³´å®‰è£å¤±æ•—

**éŒ¯èª¤**: npm install åŸ·è¡Œå¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æ¸…ç† npm å¿«å–
npm cache clean --force

# åˆªé™¤èˆŠçš„ node_modules
rmdir /s /q node_modules

# é‡æ–°å®‰è£
npm install
```

### 4. LLM åŠŸèƒ½ç„¡æ³•ä½¿ç”¨

**ç—‡ç‹€**: LLM æ¸¬è©¦æˆ–å°è©±åŠŸèƒ½å¤±æ•—

**åŸå› **: é›²ç«¯ Convex ç„¡æ³•è¨ªå•æœ¬åœ° Ollama (127.0.0.1:11434)

**è§£æ±ºæ–¹æ¡ˆ**:
1. é…ç½®é›²ç«¯ LLM API (OpenAI, Anthropic ç­‰)
2. ä¿®æ”¹ `convex/util/llm.ts` è¨­å®š
3. åœ¨ `.env.local` æ·»åŠ  API Key
4. æˆ–æ”¹ç”¨æœ¬åœ°æ¸¬è©¦ç’°å¢ƒ (`start-ai-town-local.bat`)

### 5. Convex å‡½æ•¸åŒæ­¥å¡ä½

**ç—‡ç‹€**: Convex Dev è¦–çª—é¡¯ç¤ºéŒ¯èª¤æˆ–ç„¡å›æ‡‰

**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ç¶²è·¯é€£ç·š
2. é—œé–‰ Convex Dev è¦–çª—
3. é‡æ–°åŸ·è¡Œå•Ÿå‹•è…³æœ¬
4. æª¢æŸ¥ Convex Dashboard æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

### 6. .env.local è‡ªå‹•ä¿®æ”¹

**ç—‡ç‹€**: `.env.local` è¢«è‡ªå‹•ä¿®æ”¹

**èªªæ˜**: é€™æ˜¯ Convex CLI çš„é æœŸè¡Œç‚º
- `npx convex dev` æœƒè‡ªå‹•æ›´æ–° `.env.local`
- åœ¨æ­£å¼ç’°å¢ƒä¸­,é€™æœƒå°‡ URL è¨­å®šç‚ºé›²ç«¯éƒ¨ç½²åœ°å€
- é€™æ˜¯æ­£ç¢ºä¸”é æœŸçš„è¡Œç‚º

**æ³¨æ„**: å¦‚æœä½ éœ€è¦æœ¬åœ°é–‹ç™¼,è«‹ä½¿ç”¨ `start-ai-town-local.bat`

## èˆ‡æœ¬åœ°æ¸¬è©¦ç’°å¢ƒåˆ‡æ›

### åˆ‡æ›åˆ°æœ¬åœ°æ¸¬è©¦ç’°å¢ƒ

```bash
# æ–¹æ³• 1: ä½¿ç”¨åˆ‡æ›è…³æœ¬
.\switch-convex-mode.bat

# æ–¹æ³• 2: ç›´æ¥å•Ÿå‹•æœ¬åœ°ç’°å¢ƒ
.\start-ai-town-local.bat
```

### åˆ‡æ›å›æ­£å¼ç’°å¢ƒ

```bash
# æ–¹æ³• 1: ä½¿ç”¨åˆ‡æ›è…³æœ¬
.\switch-convex-mode.bat

# æ–¹æ³• 2: ç›´æ¥å•Ÿå‹•æ­£å¼ç’°å¢ƒ
.\start-ai-town-production.bat
```

## æœ€ä½³å¯¦è¸

### 1. åŠŸèƒ½é–‹ç™¼éšæ®µ
- ä½¿ç”¨ `start-ai-town-local.bat`
- å®Œæ•´é›¢ç·šé–‹ç™¼èƒ½åŠ›
- å¿«é€Ÿè¿­ä»£èˆ‡æ¸¬è©¦

### 2. æ¸¬è©¦èˆ‡é©—è­‰éšæ®µ
- å…ˆåœ¨æœ¬åœ°ç’°å¢ƒæ¸¬è©¦
- ç¢ºèªåŠŸèƒ½ç„¡èª¤å¾Œåˆ‡æ›è‡³æ­£å¼ç’°å¢ƒ
- é©—è­‰é›²ç«¯éƒ¨ç½²æ˜¯å¦æ­£å¸¸

### 3. å±•ç¤ºèˆ‡éƒ¨ç½²éšæ®µ
- ä½¿ç”¨ `start-ai-town-production.bat`
- ç¢ºä¿ Convex é…é¡å……è¶³
- é…ç½®é›²ç«¯ LLM API (å¦‚éœ€ä½¿ç”¨ LLM åŠŸèƒ½)

### 4. æ—¥å¸¸ç¶­è­·
- å®šæœŸæª¢æŸ¥ Convex ä½¿ç”¨é‡
- ç›£æ§ API å‘¼å«æˆæœ¬
- ä¿æŒä¾è³´å¥—ä»¶æ›´æ–°

## å®‰å…¨æ€§æ³¨æ„äº‹é …

### 1. ç’°å¢ƒè®Šæ•¸ä¿è­·
- `.env.local` åŒ…å«æ•æ„Ÿè³‡è¨Š,ä¸æ‡‰æäº¤è‡³ç‰ˆæœ¬æ§åˆ¶
- ç¢ºä¿ `.gitignore` åŒ…å« `.env.local`
- API Key æ‡‰ä½¿ç”¨ç’°å¢ƒè®Šæ•¸è€Œéç¡¬ç·¨ç¢¼

### 2. Convex éƒ¨ç½²æ¬Šé™
- å®šæœŸæª¢æŸ¥å°ˆæ¡ˆæˆå“¡æ¬Šé™
- ä½¿ç”¨é©ç•¶çš„å­˜å–æ§åˆ¶
- ç›£æ§ç•°å¸¸æ´»å‹•

### 3. API Key ç®¡ç†
- å®šæœŸè¼ªæ› API Key
- ä½¿ç”¨æœ€å°æ¬Šé™åŸå‰‡
- ç›£æ§ API ä½¿ç”¨é‡

## é€²éšé…ç½®

### è‡ªè¨‚ Convex é›²ç«¯ URL

å¦‚æœä½ çš„å°ˆæ¡ˆä½¿ç”¨ä¸åŒçš„ Convex éƒ¨ç½²,ä¿®æ”¹è…³æœ¬ä¸­çš„:
```batch
set "CLOUD_CONVEX_URL=https://your-deployment.convex.cloud"
```

### èª¿æ•´ç­‰å¾…æ™‚é–“

å¦‚æœå‡½æ•¸åŒæ­¥éœ€è¦æ›´é•·æ™‚é–“,ä¿®æ”¹:
```batch
timeout /t 15 /nobreak >nul  REM æ”¹ç‚ºæ›´é•·æ™‚é–“,å¦‚ 30
```

### æ·»åŠ é æª¢æŸ¥æ­¥é©Ÿ

å¯ä»¥åœ¨è…³æœ¬ä¸­æ·»åŠ é¡å¤–çš„æª¢æŸ¥:
```batch
REM æª¢æŸ¥ Convex ç™»å…¥ç‹€æ…‹
npx convex whoami >nul 2>&1
if errorlevel 1 (
    echo âŒ è«‹å…ˆç™»å…¥ Convex: npx convex login
    goto :error_summary
)
```

## ç›¸é—œæ–‡ä»¶

- [ç’°å¢ƒè®Šæ•¸è¨­å®šèªªæ˜](./ENV_SETUP_GUIDE.md)
- [å•Ÿå‹•è…³æœ¬ä½¿ç”¨èªªæ˜](./STARTUP_SCRIPTS_GUIDE.md)
- [æœ¬åœ°æ¸¬è©¦ç’°å¢ƒè¨­å®š](../../TESTING.md)
- [å°ˆæ¡ˆæ¶æ§‹èªªæ˜](../development/ARCHITECTURE.md)

## æ”¯æ´èˆ‡å”åŠ©

å¦‚é‡åˆ°å•é¡Œ,è«‹åƒè€ƒ:
1. æœ¬æ–‡ä»¶çš„å¸¸è¦‹å•é¡Œæ’é™¤ç« ç¯€
2. [Convex å®˜æ–¹æ–‡æª”](https://docs.convex.dev/)
3. [AI Town GitHub Issues](https://github.com/a16z-infra/ai-town/issues)
4. [AI Stack Devs Discord](https://discord.gg/PQUmTBTGmT)

---

**æœ€å¾Œæ›´æ–°**: 2025-11-07
**é©ç”¨ç‰ˆæœ¬**: AI Town v1.0-mvp
**è…³æœ¬ç‰ˆæœ¬**: start-ai-town-production.bat v1.0
